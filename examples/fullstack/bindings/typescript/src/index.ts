
// Code generated by @open-rpc/client-generator DO NOT EDIT.
import { RequestManager, WebSocketTransport, HTTPTransport, Client, JSONRPCError } from "@open-rpc/client-js";
import _ from "lodash";
import { OpenrpcDocument as OpenRPC, MethodObject, ContentDescriptorObject } from "@open-rpc/meta-schema";
import { MethodCallValidator, MethodNotFoundError } from "@open-rpc/schema-utils-js";

export type IntegerXZTmW7Mv = number;
export type StringDoaGddGA = string;
export interface ObjectOfIntegerXZTmW7MvDX83NGkO {
  Ok: IntegerXZTmW7Mv;
  [k: string]: any;
}
export interface ObjectOfStringDoaGddGARMaVIgow {
  Err: StringDoaGddGA;
  [k: string]: any;
}
export interface ObjectOfStringDoaGddGAStringDoaGddGAIntegerXZTmW7MvPDRL7Kw9 {
  id: IntegerXZTmW7Mv;
  name: StringDoaGddGA;
  password: StringDoaGddGA;
  [k: string]: any;
}
export type NullQu0Arl1F = null;
export type AnyOfNullQu0Arl1FObjectOfStringDoaGddGAStringDoaGddGAIntegerXZTmW7MvPDRL7Kw9DbbVqH1Y = ObjectOfStringDoaGddGAStringDoaGddGAIntegerXZTmW7MvPDRL7Kw9 | NullQu0Arl1F;
export interface ObjectOfAnyOfNullQu0Arl1FObjectOfStringDoaGddGAStringDoaGddGAIntegerXZTmW7MvPDRL7Kw9DbbVqH1Y01YbCDyu {
  Ok: AnyOfNullQu0Arl1FObjectOfStringDoaGddGAStringDoaGddGAIntegerXZTmW7MvPDRL7Kw9DbbVqH1Y;
  [k: string]: any;
}
export type String = string;
export type Int64 = number;
export interface User {
  id: IntegerXZTmW7Mv;
  name: StringDoaGddGA;
  password: StringDoaGddGA;
  [k: string]: any;
}
export type ResultOfInt64OrString = ObjectOfIntegerXZTmW7MvDX83NGkO | ObjectOfStringDoaGddGARMaVIgow;
export type ResultOfNullableUserOrString = ObjectOfAnyOfNullQu0Arl1FObjectOfStringDoaGddGAStringDoaGddGAIntegerXZTmW7MvPDRL7Kw9DbbVqH1Y01YbCDyu | ObjectOfStringDoaGddGARMaVIgow;
/**
 *
 * Generated! Represents an alias to any of the provided schemas
 *
 */
export type AnyOfStringInt64UserResultOfInt64OrStringResultOfNullableUserOrString = String | Int64 | User | ResultOfInt64OrString | ResultOfNullableUserOrString;
export type RegisterUser = (name: String, age: Int64) => Promise<ResultOfInt64OrString>;
export type GetUser = (user: User) => Promise<ResultOfNullableUserOrString>;

export interface Options {
  transport: {
    type: "websocket" | "http" | "https";
    host: string;
    port: number;
    path?: string;
  }
}

export class OpenspecJsonrpsee {
  public rpc: Client;
  public static openrpcDocument: OpenRPC = {"openrpc":"1.3.2","info":{"title":"openspec-jsonrpsee","version":"0.1.0"},"methods":[{"name":"register_user","params":[{"name":"name","required":true,"schema":{"$schema":"https://json-schema.org/draft/2020-12/schema","title":"string","type":"string"},"deprecated":false},{"name":"age","required":true,"schema":{"$schema":"https://json-schema.org/draft/2020-12/schema","title":"int64","type":"integer","format":"int64"},"deprecated":false}],"result":{"name":"RegisterUserResponse","required":true,"schema":{"$schema":"https://json-schema.org/draft/2020-12/schema","title":"Result_of_int64_or_string","oneOf":[{"type":"object","properties":{"Ok":{"type":"integer","format":"int64","title":"integer_XZTmW7mv"}},"required":["Ok"],"title":"objectOf_integer_XZTmW7mv_DX83NGkO"},{"type":"object","properties":{"Err":{"type":"string","title":"string_doaGddGA"}},"required":["Err"],"title":"objectOf_string_doaGddGA_RMaVIgow"}]},"deprecated":false},"deprecated":false},{"name":"get_user","params":[{"name":"user","required":true,"schema":{"$schema":"https://json-schema.org/draft/2020-12/schema","title":"User","type":"object","properties":{"id":{"type":"integer","format":"int64","title":"integer_XZTmW7mv"},"name":{"type":"string","title":"string_doaGddGA"},"password":{"type":"string","title":"string_doaGddGA"}},"required":["id","name","password"]},"deprecated":false}],"result":{"name":"GetUserResponse","required":true,"schema":{"$schema":"https://json-schema.org/draft/2020-12/schema","title":"Result_of_Nullable_User_or_string","oneOf":[{"type":"object","properties":{"Ok":{"anyOf":[{"type":"object","properties":{"id":{"type":"integer","format":"int64","title":"integer_XZTmW7mv"},"name":{"type":"string","title":"string_doaGddGA"},"password":{"type":"string","title":"string_doaGddGA"}},"required":["id","name","password"],"title":"objectOf_string_doaGddGA_string_doaGddGA_integer_XZTmW7mv_pDRL7Kw9"},{"type":"null","title":"null_Qu0Arl1F"}],"title":"anyOf_null_Qu0Arl1F_objectOf_string_doaGddGA_string_doaGddGA_integer_XZTmW7mv_pDRL7Kw9_DbbVqH1Y"}},"required":["Ok"],"title":"objectOf_anyOf_null_Qu0Arl1F_objectOf_string_doaGddGA_string_doaGddGA_integer_XZTmW7mv_pDRL7Kw9_DbbVqH1Y_01ybCDyu"},{"type":"object","properties":{"Err":{"type":"string","title":"string_doaGddGA"}},"required":["Err"],"title":"objectOf_string_doaGddGA_RMaVIgow"}],"$defs":{"User":{"type":"object","properties":{"id":{"type":"integer","format":"int64","title":"integer_XZTmW7mv"},"name":{"type":"string","title":"string_doaGddGA"},"password":{"type":"string","title":"string_doaGddGA"}},"required":["id","name","password"],"title":"objectOf_string_doaGddGA_string_doaGddGA_integer_XZTmW7mv_pDRL7Kw9"}}},"deprecated":false},"deprecated":false}]} ;
  public transport: HTTPTransport | WebSocketTransport;
  private validator: MethodCallValidator;
  private timeout: number | undefined;

  constructor(options: Options) {

    if (options.transport === undefined || options.transport.type === undefined) {
      throw new Error("Invalid constructor params");
    }
    const {type, host, port} = options.transport;
    let path = options.transport.path || "";
    if(path && path[0] !== "/") {
        path = "/" + path;
    }
    switch (type) {
      case 'http':
      case 'https':
        this.transport = new HTTPTransport(type + "://" + host + ":" + port + path)
        break;
      case 'websocket':
        this.transport = new WebSocketTransport("ws://" + host + ":" + port + path)
        break;
      default:
        throw new Error("unsupported transport");
        break;
    }
    this.rpc = new Client(new RequestManager([this.transport]));
    this.validator = new MethodCallValidator(OpenspecJsonrpsee.openrpcDocument);
  }
  /**
   * Adds a JSONRPC notification handler to handle receiving notifications.
   * @example
   * myClient.onNotification((data)=>console.log(data));
   */
  public onNotification(callback: (data: any) => void) {
    this.rpc.onNotification(callback);
  }

  /**
   * Adds an optional JSONRPCError handler to handle receiving errors that cannot be resolved to a specific request
   * @example
   * myClient.onError((err: JSONRPCError)=>console.log(err.message));
   */
  public onError(callback: (data: JSONRPCError) => void) {
     this.rpc.onError(callback);
  }

  /**
   * Sets a default timeout in ms for all requests excluding notifications.
   * @example
   * // 20s timeout
   * myClient.setDefaultTimeout(20000);
   * // Removes timeout from request
   * myClient.setDefaultTimeout(undefined);
   */
   public setDefaultTimeout(ms?: number) {
    this.timeout = ms;
  }

  /**
   * Initiates [[OpenspecJsonrpsee.startBatch]] in order to build a batch call.
   *
   * Subsequent calls to [[OpenspecJsonrpsee.request]] will be added to the batch.
   * Once [[OpenspecJsonrpsee.stopBatch]] is called, the promises for the [[OpenspecJsonrpsee.request]]
   * will then be resolved.  If there is already a batch in progress this method is a noop.
   *
   * @example
   * myClient.startBatch();
   * myClient.foo().then(() => console.log("foobar"))
   * myClient.bar().then(() => console.log("foobarbaz"))
   * myClient.stopBatch();
   */
  public startBatch(): void {
    return this.rpc.startBatch();
  }

  /**
   * Initiates [[Client.stopBatch]] in order to finalize and send the batch to the underlying transport.
   *
   * stopBatch will send the [[OpenspecJsonrpsee]] calls made since the last [[OpenspecJsonrpsee.startBatch]] call. For
   * that reason, [[OpenspecJsonrpsee.startBatch]] MUST be called before [[OpenspecJsonrpsee.stopBatch]].
   *
   * @example
   * myClient.startBatch();
   * myClient.foo().then(() => console.log("foobar"))
   * myClient.bar().then(() => console.log("foobarbaz"))
   * myClient.stopBatch();
   */
  public stopBatch(): void {
    return this.rpc.stopBatch();
  }

  private request(methodName: string, params: any[]): Promise<any> {
    const methodObject = _.find(OpenspecJsonrpsee.openrpcDocument.methods, ({name}) => name === methodName) as MethodObject;
    const notification = methodObject.result ? false : true;
    const openRpcMethodValidationErrors = this.validator.validate(methodName, params);
    if ( openRpcMethodValidationErrors instanceof MethodNotFoundError || openRpcMethodValidationErrors.length > 0) {
      return Promise.reject(openRpcMethodValidationErrors);
    }

    let rpcParams;
    if (methodObject.paramStructure && methodObject.paramStructure === "by-name") {
      rpcParams = _.zipObject(params, _.map(methodObject.params, "name"));
    } else {
      rpcParams = params;
    }
    if (notification) {
      return this.rpc.notify(methodName, rpcParams);
    }
    return this.rpc.request(methodName, rpcParams, this.timeout);
  }

  
  /**
   * 
   */
  // tslint:disable-next-line:max-line-length
  public register_user: RegisterUser = (...params) => {
    return this.request("register_user", params);
  }
  
  /**
   * 
   */
  // tslint:disable-next-line:max-line-length
  public get_user: GetUser = (...params) => {
    return this.request("get_user", params);
  }
  
}
export default OpenspecJsonrpsee;
